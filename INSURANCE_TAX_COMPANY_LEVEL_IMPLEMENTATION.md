# ููู ุงูุชุฃูููุงุช ูุงูุถุฑุงุฆุจ ุฅูู ูุณุชูู ุงูุดุฑูุฉ - ุชูุฑูุฑ ุงูุชูููุฐ

## ููุฎุต ุงูุชุนุฏูู

ุชู ููู ุงูุชุฃูููุงุช ูุงูุถุฑุงุฆุจ ูู ุจูุงูุงุช ุงูููุธู ุงููุฑุฏูุฉ ุฅูู ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ ุนูู ูุณุชูู ุงูุดุฑูุฉุ ูุน ุฅููุงููุฉ ุงุฎุชูุงุฑ ุงูููุน (ูุณุจุฉ % ุฃู ูุจูุบ ุซุงุจุช).

---

## ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช โ

**Migration**: `add_company_level_insurance_and_tax_settings.sql`

ุชู ุฅุถุงูุฉ ุงูุญููู ุงูุชุงููุฉ ุฅูู ุฌุฏูู `payroll_settings`:

```sql
-- ุญููู ุงูุชุฃูููุงุช
insurance_type text DEFAULT 'percentage' CHECK (insurance_type IN ('percentage', 'fixed'))
insurance_value numeric DEFAULT 0 CHECK (insurance_value >= 0)

-- ุญููู ุงูุถุฑุงุฆุจ
tax_type text DEFAULT 'percentage' CHECK (tax_type IN ('percentage', 'fixed'))
tax_value numeric DEFAULT 0 CHECK (tax_value >= 0)
```

**ุงูููู ุงูุงูุชุฑุงุถูุฉ**:
- `insurance_type`: `'percentage'` (ูุณุจุฉ %)
- `insurance_value`: `0`
- `tax_type`: `'percentage'` (ูุณุจุฉ %)
- `tax_value`: `0`

### 2. ูุงุฌูุฉ ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ โ

**ุงูููู**: `src/components/PayrollSettings.tsx`

ุชู ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ ุจุนููุงู **"ุงูุถุฑุงุฆุจ ูุงูุชุฃูููุงุช"** ูุชุถูู:

#### ุฃ) ุงูุชุฃูููุงุช:
- **ุญูู ุงูููุน**: Select box
  - ูุณุจุฉ % (percentage)
  - ูุจูุบ ุซุงุจุช (fixed)
- **ุญูู ุงููููุฉ**:
  - ุฅุฐุง ูุณุจุฉ: ุฅุฏุฎุงู ุฑูู ูู 0-100
  - ุฅุฐุง ุซุงุจุช: ุฅุฏุฎุงู ูุจูุบ ุจุงูุนููุฉ

#### ุจ) ุงูุถุฑูุจุฉ:
- **ุญูู ุงูููุน**: Select box
  - ูุณุจุฉ % (percentage)
  - ูุจูุบ ุซุงุจุช (fixed)
- **ุญูู ุงููููุฉ**:
  - ุฅุฐุง ูุณุจุฉ: ุฅุฏุฎุงู ุฑูู ูู 0-100
  - ุฅุฐุง ุซุงุจุช: ุฅุฏุฎุงู ูุจูุบ ุจุงูุนููุฉ

**ููุงุญุธุฉ ูุนุฑูุถุฉ ูููุณุชุฎุฏู**:
> "ูุฐู ุงูุฅุนุฏุงุฏุงุช ุณุชูุทุจู ุนูู ุฌููุน ุงูููุธููู ูู ุงูุดุฑูุฉ. ุณูุชู ุญุณุงุจ ุงูุชุฃูููุงุช ูุงูุถุฑุงุฆุจ ุชููุงุฆููุง ุจูุงุกู ุนูู ุงูุฑุงุชุจ ุงูุฃุณุงุณู ููู ููุธู."

### 3. ููุทู ุงูุญุณุงุจ โ

**ุงูููู**: `src/utils/payrollCalculations.ts`

ุชู ุชุญุฏูุซ ุฏุงูุฉ `calculatePayroll()` ูุชูุจู ูุนุงูููู ุฌุฏูุฏูู:

```typescript
insuranceSettings?: { type: 'percentage' | 'fixed'; value: number }
taxSettings?: { type: 'percentage' | 'fixed'; value: number }
```

**ููุงุนุฏ ุงูุญุณุงุจ**:

```javascript
// ุญุณุงุจ ุงูุชุฃูููุงุช
if (insuranceType === 'percentage') {
  socialInsurance = (baseSalary * insuranceValue) / 100
} else {
  socialInsurance = insuranceValue
}

// ุญุณุงุจ ุงูุถุฑูุจุฉ
if (taxType === 'percentage') {
  incomeTax = (baseSalary * taxValue) / 100
} else {
  incomeTax = taxValue
}
```

**Fallback ููุชูุงูู ุงูุฎููู**:
- ุฅุฐุง ูู ุชููุฑุฑ ุงูุฅุนุฏุงุฏุงุชุ ูุณุชุฎุฏู ุงููุธุงู ุงูููู ุงููุฏููุฉ ูู ุญููู ุงูููุธู (ุฅู ูุฌุฏุช)
- ูุฐุง ูุถูู ุนูู ุงูุจูุงูุงุช ุงููุฏููุฉ ุจุฏูู ูุดุงูู

### 4. ูููุฐุฌ ุงูููุธู โ

**ุงูููู**: `src/pages/Employees.tsx`

**ุชู ุฅุฒุงูุฉ**:
- ุญูู "ุงูุชุฃูููุงุช ุงูุงุฌุชูุงุนูุฉ" ูู ูููุฐุฌ ุฅุถุงูุฉ ุงูููุธู
- ุญูู "ุถุฑูุจุฉ ุงูุฏุฎู" ูู ูููุฐุฌ ุฅุถุงูุฉ ุงูููุธู
- ุญูู "ุงูุชุฃูููุงุช ุงูุงุฌุชูุงุนูุฉ" ูู ูููุฐุฌ ุชุนุฏูู ุงูููุธู
- ุญูู "ุถุฑูุจุฉ ุงูุฏุฎู" ูู ูููุฐุฌ ุชุนุฏูู ุงูููุธู

**ุชู ุงูุงุญุชูุงุธ**:
- ุนุฑุถ ุงูุชุฃูููุงุช ูุงูุถุฑูุจุฉ ูู ุชูุงุตูู ุงูููุธู (ููููู ุงูููุฌูุฏุฉ ูุณุจูุงู)
- ุงูุญููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ููุชูุงูู ุงูุฎููู)

### 5. ุนุฑุถ ูุดู ุงููุฑุชุจ โ

**ุงููููุงุช**:
- `src/components/EmployeePayrollDetailsModal.tsx`
- `src/components/PayrollCardCompact.tsx`
- `src/components/PayrollCardPrintA4.tsx`

**ูู ูุชู ุชุบููุฑ ุฃู ุดูุก ูู ุงูุนุฑุถ**:
- ุงูุชุฃูููุงุช ุชุธูุฑ ูุตู ูู ุงูุฎุตููุงุช
- ุงูุถุฑูุจุฉ ุชุธูุฑ ูุตู ูู ุงูุฎุตููุงุช
- ุงูููู ูุญุณูุจุฉ ุชููุงุฆูุงู ุจูุงุกู ุนูู ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ
- ููุณ ุงูุชุตููู ูุงูุฃููุงู
- ููุณ ุชูุณูู PDF

### 6. ุญูุธ ุงูุฅุนุฏุงุฏุงุช โ

**ุงูููู**: `src/pages/Payroll.tsx`

ุชู ุชุญุฏูุซ ุฏุงูุฉ `updateSettings()` ูุญูุธ ุงูุญููู ุงูุฌุฏูุฏุฉ:

```typescript
await supabase
  .from('payroll_settings')
  .upsert({
    ...
    insurance_type: settings.insurance_type || 'percentage',
    insurance_value: settings.insurance_value || 0,
    tax_type: settings.tax_type || 'percentage',
    tax_value: settings.tax_value || 0,
    ...
  })
```

---

## ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุชุฃูููุงุช ุจูุณุจุฉ 11%

**ุงูุฅุนุฏุงุฏุงุช**:
- ููุน ุงูุชุฃูููุงุช: ูุณุจุฉ %
- ูููุฉ ุงูุชุฃูููุงุช: 11

**ุงูุญุณุงุจ**:
- ููุธู ุจุฑุงุชุจ ุฃุณุงุณู 10,000 ุฌููู
- ุงูุชุฃูููุงุช = 10,000 ร 11 / 100 = **1,100 ุฌููู**

### ูุซุงู 2: ุถุฑูุจุฉ ุซุงุจุชุฉ 500 ุฌููู

**ุงูุฅุนุฏุงุฏุงุช**:
- ููุน ุงูุถุฑูุจุฉ: ูุจูุบ ุซุงุจุช
- ูููุฉ ุงูุถุฑูุจุฉ: 500

**ุงูุญุณุงุจ**:
- ููุธู ุจุฑุงุชุจ ุฃุณุงุณู 8,000 ุฌููู
- ุงูุถุฑูุจุฉ = **500 ุฌููู** (ุซุงุจุชุฉ ูุฌููุน ุงูููุธููู)

### ูุซุงู 3: ุชุฃูููุงุช ุจูุณุจุฉ 9% + ุถุฑูุจุฉ ุจูุณุจุฉ 14%

**ุงูุฅุนุฏุงุฏุงุช**:
- ููุน ุงูุชุฃูููุงุช: ูุณุจุฉ % | ูููุฉ: 9
- ููุน ุงูุถุฑูุจุฉ: ูุณุจุฉ % | ูููุฉ: 14

**ุงูุญุณุงุจ**:
- ููุธู ุจุฑุงุชุจ ุฃุณุงุณู 15,000 ุฌููู
- ุงูุชุฃูููุงุช = 15,000 ร 9 / 100 = **1,350 ุฌููู**
- ุงูุถุฑูุจุฉ = 15,000 ร 14 / 100 = **2,100 ุฌููู**
- ุฅุฌูุงูู ุงูุฎุตููุงุช (ุชุฃูููุงุช + ุถุฑูุจุฉ ููุท) = **3,450 ุฌููู**

### ูุซุงู 4: ุจุฏูู ุชุฃูููุงุช ุฃู ุถุฑุงุฆุจ (ููุดุฑูุงุช ุงูุฌุฏูุฏุฉ)

**ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ**:
- ููุน ุงูุชุฃูููุงุช: ูุณุจุฉ % | ูููุฉ: 0
- ููุน ุงูุถุฑูุจุฉ: ูุณุจุฉ % | ูููุฉ: 0

**ุงูุญุณุงุจ**:
- ููุธู ุจุฑุงุชุจ ุฃุณุงุณู 12,000 ุฌููู
- ุงูุชุฃูููุงุช = 12,000 ร 0 / 100 = **0 ุฌููู**
- ุงูุถุฑูุจุฉ = 12,000 ร 0 / 100 = **0 ุฌููู**
- ูุง ุชูุฌุฏ ุฎุตููุงุช (ูุง ูู ุชูู ููุงู ุฌุฒุงุกุงุช ุฃู ุบูุงุจ)

---

## ุฏูุฑุฉ ุงูุนูู ุงููุงููุฉ

### ููุดุฑูุงุช ุงูุฌุฏูุฏุฉ:

1. ุนูุฏ ูุชุญ ุตูุญุฉ ุงูุฑูุงุชุจ ูุฃูู ูุฑุฉ:
   - ูุชู ุฅูุดุงุก ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ ุชููุงุฆูุงู
   - ุงูุชุฃูููุงุช: ูุณุจุฉ 0%
   - ุงูุถุฑูุจุฉ: ูุณุจุฉ 0%

2. ุงููุณุคูู ูุฐูุจ ุฅูู ุชุจููุจ "ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ"

3. ููุชุญ ูุณู "ุงูุถุฑุงุฆุจ ูุงูุชุฃูููุงุช"

4. ูุฎุชุงุฑ:
   - ููุน ุงูุชุฃูููุงุช (ูุณุจุฉ ุฃู ุซุงุจุช)
   - ูููุฉ ุงูุชุฃูููุงุช
   - ููุน ุงูุถุฑูุจุฉ (ูุณุจุฉ ุฃู ุซุงุจุช)
   - ูููุฉ ุงูุถุฑูุจุฉ

5. ูุถุบุท "ุญูุธ ุงูุฅุนุฏุงุฏุงุช"

6. ุนูุฏ ุญุณุงุจ ุงูุฑูุงุชุจ:
   - ูุชู ุงุญุชุณุงุจ ุงูุชุฃูููุงุช ูุงูุถุฑุงุฆุจ ุชููุงุฆูุงู ููู ููุธู
   - ุจูุงุกู ุนูู ุฑุงุชุจู ุงูุฃุณุงุณู
   - ูููุงู ููุฅุนุฏุงุฏุงุช ุงููุญููุธุฉ

7. ูู ูุดู ุงููุฑุชุจ:
   - ุชุธูุฑ ุงูุชุฃูููุงุช ููููุฉ ูุญุณูุจุฉ ูู ุงูุฎุตููุงุช
   - ุชุธูุฑ ุงูุถุฑูุจุฉ ููููุฉ ูุญุณูุจุฉ ูู ุงูุฎุตููุงุช
   - ุจููุณ ุงูุดูู ูุงูุชุตููู ุงูุณุงุจู

### ููุดุฑูุงุช ุงูููุฌูุฏุฉ:

1. ุงูููุธููู ุงููุฏุงูู ูุฏ ูููู ูุฏููู ููู ุชุฃูููุงุช/ุถุฑุงุฆุจ ูุฏููุฉ

2. ุนูุฏ ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ:
   - ุฌููุน ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ ุชุณุชุฎุฏู ุงูุฅุนุฏุงุฏุงุช ุงูุฌุฏูุฏุฉ
   - ุงูููู ุงููุฏููุฉ ุชูุณุชุฎุฏู ููุท ูู fallback

3. ูููุตุญ ุจูุฑุงุฌุนุฉ ุงูุฅุนุฏุงุฏุงุช ูุถุจุทูุง ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุดุฑูุฉ

---

## ุงููููุงุช ุงููุนุฏูุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช:
1. `supabase/migrations/add_company_level_insurance_and_tax_settings.sql` (ุฌุฏูุฏ)

### Backend/Utils:
2. `src/utils/ensurePayrollSettings.ts` (ูุญุฏุซ)
3. `src/utils/payrollCalculations.ts` (ูุญุฏุซ)

### UI Components:
4. `src/components/PayrollSettings.tsx` (ูุญุฏุซ)

### Pages:
5. `src/pages/Payroll.tsx` (ูุญุฏุซ)
6. `src/pages/Employees.tsx` (ูุญุฏุซ - ุญุฐู ุญููู)

### ูู ูุชู ุชุนุฏูููุง (ุงูุนุฑุถ ูุนูู ุชููุงุฆูุงู):
- `src/components/EmployeePayrollDetailsModal.tsx`
- `src/components/PayrollCardCompact.tsx`
- `src/components/PayrollCardPrintA4.tsx`
- `src/components/PayrollPdfLayout.tsx`

---

## ุงูููุงุฆุฏ

### 1. ุฅุฏุงุฑุฉ ูุฑูุฒูุฉ โ
- ุฅุนุฏุงุฏุงุช ูุงุญุฏุฉ ูุฌููุน ุงูููุธููู
- ุณูููุฉ ุงูุชุนุฏูู ูุงูุชุญุฏูุซ
- ูุง ุญุงุฌุฉ ูุชุนุฏูู ูู ููุธู ุนูู ุญุฏุฉ

### 2. ูุฑููุฉ ุฃูุซุฑ โ
- ุฅููุงููุฉ ุงุฎุชูุงุฑ ูุณุจุฉ ูุฆููุฉ ุฃู ูุจูุบ ุซุงุจุช
- ููุงุณุจ ูุฎุชูู ุฃููุงุน ุงูุดุฑูุงุช ูุงูุฃูุธูุฉ

### 3. ุฏูุฉ ุฃุนูู โ
- ุญุณุงุจ ุชููุงุฆู ุจูุงุกู ุนูู ุงูุฑุงุชุจ ุงูุฃุณุงุณู
- ูุง ูุฌุงู ููุฃุฎุทุงุก ุงููุฏููุฉ
- ุชูุญูุฏ ุงููุนุงููุฑ

### 4. ูุงุฌูุฉ ุฃูุธู โ
- ูููุฐุฌ ุงูููุธู ุฃุจุณุท ูุฃูู ุชุนููุฏุงู
- ุงูุชุฑููุฒ ุนูู ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ ูุงููุธูููุฉ ููุท
- ุงูุฅุนุฏุงุฏุงุช ุงููุงููุฉ ูู ููุงู ูุงุญุฏ

### 5. ุงูุชูุงูู ุงูุฎููู โ
- ุงูุจูุงูุงุช ุงููุฏููุฉ ุชุนูู ุจุฏูู ูุดุงูู
- ูุง ุญุงุฌุฉ ูุชุฑุญูู ุงูุจูุงูุงุช
- ูุฏุนู ุงูููู ุงููุฑุฏูุฉ ููููุธููู (fallback)

---

## ุงูุงุฎุชุจุงุฑ

### ุชู ุงุฎุชุจุงุฑ:

โ ุงูุจูุงุก ุจูุฌุงุญ (`npm run build`)
โ ุฅูุดุงุก Migration ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ ุฅุถุงูุฉ ุงููุณู ุงูุฌุฏูุฏ ูู UI
โ ุญูุธ ุงูุฅุนุฏุงุฏุงุช ูู `payroll_settings`
โ ุชูุฑูุฑ ุงูุฅุนุฏุงุฏุงุช ุฅูู ุฏุงูุฉ ุงูุญุณุงุจ
โ ุญุณุงุจ ุงูุชุฃูููุงุช ูุงูุถุฑุงุฆุจ ุจุดูู ุตุญูุญ
โ ุนุฑุถ ุงูููู ูู ูุดู ุงููุฑุชุจ
โ ุนุฑุถ ุงูููู ูู PDF
โ ุญุฐู ุญููู ุงูุฅุฏุฎุงู ูู ูููุฐุฌ ุงูููุธู

---

## ุงูุชูุตูุงุช

### ููุดุฑูุงุช ุงูุฌุฏูุฏุฉ:
1. ุงุฐูุจ ุฅูู ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ
2. ุงูุชุญ ูุณู "ุงูุถุฑุงุฆุจ ูุงูุชุฃูููุงุช"
3. ุญุฏุฏ ุงูููุน ูุงููููุฉ ุงูููุงุณุจุฉ
4. ุงุญูุธ ุงูุฅุนุฏุงุฏุงุช
5. ุงุจุฏุฃ ุจุฅุถุงูุฉ ุงูููุธููู

### ููุดุฑูุงุช ุงูููุฌูุฏุฉ:
1. ุฑุงุฌุน ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ
2. ุญุฏุฏ ุงููุธุงู ุงูููุงุณุจ (ูุณุจุฉ ุฃู ุซุงุจุช)
3. ุงุญูุธ ุงูุฅุนุฏุงุฏุงุช
4. ุงุฎุชุจุฑ ุญุณุงุจ ุฑูุงุชุจ ูุจุนุถ ุงูููุธููู
5. ุชุฃูุฏ ูู ุงููุชุงุฆุฌ

---

## ุงูุฎูุงุตุฉ

โ **ุชู ุงูุชูููุฐ ุจูุฌุงุญ**

- ุงูุชุฃูููุงุช ูุงูุถุฑุงุฆุจ ุงูุขู ุนูู ูุณุชูู ุงูุดุฑูุฉ
- ุฅููุงููุฉ ุงูุงุฎุชูุงุฑ ุจูู ูุณุจุฉ ูุฆููุฉ ุฃู ูุจูุบ ุซุงุจุช
- ุญุฐู ุงูุญููู ูู ูููุฐุฌ ุงูููุธู
- ุงูุนุฑุถ ูู ูุดู ุงููุฑุชุจ ุจููุณ ุงูุดูู
- PDF ูุนูู ุจููุณ ุงูุชุตููู
- ุงูููู ุงูุงูุชุฑุงุถูุฉ: ูุณุจุฉ 0% (ูุง ุฎุตููุงุช)
- ูุชูุงูู ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ
- ุงูุจูุงุก ูุฌุญ ุจุฏูู ุฃุฎุทุงุก

**ุงููุธุงู ุฌุงูุฒ ููุฅูุชุงุฌ** ๐
