# ููุฒุฉ ุฅุฐู ุงูุชุฃุฎูุฑ (Delay Permission Feature)

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅุถุงูุฉ ูุธุงู ุฅุฐู ุงูุชุฃุฎูุฑ ุงูุฐู ูุณูุญ ููููุธููู ุจุชูุฏูู ุทูุจุงุช ูุชุจุฑูุฑ ุงูุชุฃุฎูุฑุ ููุง ูููู ูู ุฎุตู ุงูุชุฃุฎูุฑ ุนูุฏ ุงูููุงููุฉ ูู ูุจู ุงูุฅุฏุงุฑุฉ.

---

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุฅุฏุงุฑุฉ ุทูุจุงุช ุฅุฐู ุงูุชุฃุฎูุฑ
- **ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ**: ูููู ููุฅุฏุงุฑุฉ ุฅูุดุงุก ุทูุจุงุช ุฅุฐู ุชุฃุฎูุฑ ููููุธููู
- **ุชุญุฏูุฏ ุงููุชุฑุฉ ุจุงูุณุงุนุงุช ูุงูุฏูุงุฆู**: ุฏูุฉ ุนุงููุฉ ูู ุชุญุฏูุฏ ููุช ุงูุจุฏุงูุฉ ูุงูููุงูุฉ
- **ุงูููุงููุฉ/ุงูุฑูุถ**: ูุธุงู ููุงููุฉ ูุฑู ููุทูุจุงุช
- **ุงูุณุจุจ (ุงุฎุชูุงุฑู)**: ุฅููุงููุฉ ุฅุถุงูุฉ ุณุจุจ ููุชุฃุฎูุฑ

### 2. ุงูุชุญูู ูู ุงูุตุญุฉ (Validation)
- **ููุช ุงูููุงูุฉ > ููุช ุงูุจุฏุงูุฉ**: ุงูุชุญูู ูู ุตุญุฉ ุงููุทุงู ุงูุฒููู
- **ุญุฏ ุฃูุตู ูููู**: ูุงุจู ููุชุฎุตูุต (ุงูุชุฑุงุถู: 2 ุณุงุนุฉ)
- **ููุน ุงูุชุฏุงุฎู**: ูุง ููุณูุญ ุจูุฌูุฏ ุฅุฐููู ูู ููุณ ุงูููู ูููุณ ุงูููุธู
- **ูุชุฑุฉ ุงูุฑูุงุชุจ**: ูุคุซุฑ ููุท ุนูู ุงูุฃุฐููุงุช ุถูู ูุชุฑุฉ ุงูุฑูุงุชุจ ุงููุญุฏุฏุฉ

### 3. ุงูุชุฃุซูุฑ ุนูู ุญุณุงุจ ุงูุฑูุงุชุจ
- **ุฎุตู ุงูุชุฃุฎูุฑ ุงูุตุงูู**: `lateMinutesNet = max(0, lateMinutes - approvedPermissionMinutes)`
- **ูุง ูุคุซุฑ ุนูู ุงูุบูุงุจ**: ุงูุฅุฐู ูููู ููุท ูู ุฎุตู ุงูุชุฃุฎูุฑ ูููุณ ุงูุบูุงุจ
- **ุญุณุงุจ ุชููุงุฆู**: ูุชู ุงุญุชุณุงุจ ุงูุชุฃุซูุฑ ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ูุดู ุงูุฑูุงุชุจ

### 4. ุงูุฅุนุฏุงุฏุงุช ุงููุงุจูุฉ ููุชุฎุตูุต
- **ุชูุนูู/ุชุนุทูู ุงูููุฒุฉ**: ON/OFF
- **ุงูุญุฏ ุงูุฃูุตู ูุณุงุนุงุช ุงูุฅุฐู ููููุงู**: ูุงุจู ููุชุนุฏูู (ุงูุชุฑุงุถู: 2 ุณุงุนุฉ)
- **ุงูุณูุงุญ ุจุงูุฏูุงุฆู**: ุชูุนูู ุฏูุฉ ุงูุฏูุงุฆู (ON/OFF)

---

## ุงูุจููุฉ ุงูุชูููุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุฌุฏูู: `delay_permissions`
```sql
CREATE TABLE delay_permissions (
  id uuid PRIMARY KEY,
  company_id uuid NOT NULL,          -- ููุนุฒู ูุชุนุฏุฏ ุงููุณุชุฃุฌุฑูู
  employee_id uuid NOT NULL,         -- ุงูููุธู ุงููุนูู
  date date NOT NULL,                -- ุชุงุฑูุฎ ุงูุฅุฐู
  start_time time NOT NULL,          -- ููุช ุงูุจุฏุงูุฉ
  end_time time NOT NULL,            -- ููุช ุงูููุงูุฉ
  minutes integer NOT NULL,          -- ุฅุฌูุงูู ุงูุฏูุงุฆู (ูุญุณูุจ)
  reason text,                       -- ุงูุณุจุจ (ุงุฎุชูุงุฑู)
  status text NOT NULL,              -- pending|approved|rejected
  decided_by uuid,                   -- ุงููุณุคูู ุงูุฐู ุงุชุฎุฐ ุงููุฑุงุฑ
  decided_at timestamptz,            -- ููุช ุงููุฑุงุฑ
  created_at timestamptz,
  updated_at timestamptz,

  CONSTRAINT valid_time_range CHECK (end_time > start_time),
  CONSTRAINT positive_minutes CHECK (minutes > 0)
);
```

#### ุฅุถุงูุงุช ุนูู `payroll_settings`
```sql
ALTER TABLE payroll_settings ADD COLUMN:
- delay_permission_enabled boolean DEFAULT true
- max_delay_hours_per_day numeric(5,2) DEFAULT 2.0
- allow_delay_minutes boolean DEFAULT true
```

### ุงูุฃูุงู (RLS Policies)
```sql
-- ุงููุณุคูููู ูููููู:
- ุนุฑุถ ุฌููุน ุงูุฃุฐููุงุช ูู ุดุฑูุชูู
- ุฅูุดุงุก ุฃุฐููุงุช ุฌุฏูุฏุฉ
- ุชุญุฏูุซ ุงูุญุงูุฉ (ููุงููุฉ/ุฑูุถ)
- ุญุฐู ุงูุฃุฐููุงุช
```

### ุงูููุงุฑุณ (Indexes)
```sql
CREATE INDEX:
- idx_delay_permissions_company_id
- idx_delay_permissions_employee_id
- idx_delay_permissions_date
- idx_delay_permissions_status
```

---

## ููุทู ุญุณุงุจ ุงููุฑุชุจุงุช

### ูุจู ุงูููุฒุฉ โ
```typescript
lateMinutes = 60 // ุงูุชุฃุฎูุฑ ุงููุนูู
deduction = calculateDeduction(60) // ุฎุตู ูุงูู
```

### ุจุนุฏ ุงูููุฒุฉ โ
```typescript
lateMinutes = 60               // ุงูุชุฃุฎูุฑ ุงููุนูู
permissionMinutes = 30         // ุฅุฐู ูุนุชูุฏ
netLateMinutes = max(0, 60 - 30) = 30  // ุตุงูู ุงูุชุฃุฎูุฑ
deduction = calculateDeduction(30)     // ุฎุตู ุนูู 30 ุฏูููุฉ ููุท
```

### ููุฏ ุงูุญุณุงุจ
```typescript
export interface DelayPermission {
  date: string;
  minutes: number;
  status: 'approved';
}

// ูู calculatePayroll
const latenessBreakdown = attendanceRecords
  .filter(record => record.late_minutes > 0)
  .map(record => {
    const recordDate = record.check_in_time.split('T')[0];

    // ุงูุจุญุซ ุนู ุฅุฐู ูุนุชูุฏ ูู ููุณ ุงูููู
    const permissionForDate = delayPermissions.find(
      permission => permission.date === recordDate && permission.status === 'approved'
    );

    const permissionMinutes = permissionForDate ? permissionForDate.minutes : 0;

    // ุญุณุงุจ ุตุงูู ุงูุชุฃุฎูุฑ
    const netLateMinutes = Math.max(0, record.late_minutes - permissionMinutes);

    // ุญุณุงุจ ุงูุฎุตู ุนูู ุงูุตุงูู ููุท
    const { deduction, ruleApplied } = calculateLatenessDeduction(
      netLateMinutes,
      dailyRate,
      lateDeductionRules
    );

    return {
      date: recordDate,
      lateMinutes: record.late_minutes,
      permissionMinutes: permissionMinutes > 0 ? permissionMinutes : undefined,
      netLateMinutes: permissionMinutes > 0 ? netLateMinutes : undefined,
      deduction,
      ruleApplied
    };
  });
```

---

## ูุงุฌูุฉ ุงููุณุชุฎุฏู (UI)

### 1. ุฒุฑ ุงูุฅุฐู ูู ุตูุญุฉ ุงูุทูุจุงุช
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ุทูุจุงุช ุงูุฅุฌุงุฒุงุช                      โ
โ                                         โ
โ [๐ ุฅุฐู ุชุฃุฎูุฑ] โ ุฒุฑ ุฌุฏูุฏ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 2. ูุงูุฐุฉ ุฅุฐู ุงูุชุฃุฎูุฑ (Modal)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ุฅุฐู ุงูุชุฃุฎูุฑ                          โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ [ุฅุฐู ุฌุฏูุฏ] [ุงูุณุฌู]                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                          โ
โ ุงูููุธู: [ุงุฎุชุฑ ููุธู โผ]                  โ
โ ุงูุชุงุฑูุฎ: [2026-01-30]                   โ
โ                                          โ
โ ูู ุงูุณุงุนุฉ: [09:00]  ุฅูู ุงูุณุงุนุฉ: [09:30]โ
โ                                          โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ุงููุฏุฉ ุงูุฅุฌูุงููุฉ: 30 ุฏูููุฉ         โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                          โ
โ ุงูุณุจุจ (ุงุฎุชูุงุฑู):                        โ
โ [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ]   โ
โ                                          โ
โ [ุฅุฑุณุงู ุงูุทูุจ] [ุฅูุบุงุก]                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 3. ุณุฌู ุงูุฃุฐููุงุช
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุญูุฏ ุฃุญูุฏ - EMP001           [โ ูุนุชูุฏ]   โ
โ ๐ 30/01/2026  ๐ 09:00 - 09:30           โ
โ ุงููุฏุฉ: 30 ุฏูููุฉ                           โ
โ ุงูุณุจุจ: ุญุงูุฉ ุทุงุฑุฆุฉ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุณุงุฑุฉ ุนูู - EMP002            [โณ ูุนูู]   โ
โ ๐ 29/01/2026  ๐ 08:30 - 09:00           โ
โ ุงููุฏุฉ: 30 ุฏูููุฉ                           โ
โ [ููุงููุฉ] [ุฑูุถ] [ุญุฐู]                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 4. ุฅุนุฏุงุฏุงุช ุฅุฐู ุงูุชุฃุฎูุฑ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุฅุนุฏุงุฏุงุช ุฅุฐู ุงูุชุฃุฎูุฑ                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โน๏ธ ุฅุฐู ุงูุชุฃุฎูุฑ ูุณูุญ ููููุธููู ุจุชูุฏูู    โ
โ   ุทูุจุงุช ูุชุจุฑูุฑ ุงูุชุฃุฎูุฑ...              โ
โ                                         โ
โ ุชูุนูู ุฅุฐู ุงูุชุฃุฎูุฑ         [ON]  โก    โ
โ                                         โ
โ ุงูุญุฏ ุงูุฃูุตู ูุณุงุนุงุช ุงูุฅุฐู/ุงูููู:        โ
โ [2.0] ุณุงุนุฉ                              โ
โ (ุงูุญุฏ ุงูุฃูุตู ูุณุงุนุงุช ุงูุชุฃุฎูุฑ ุงููุณููุญ ุจูุง)โ
โ                                         โ
โ ุงูุณูุงุญ ุจุงูุฏูุงุฆู           [ON]  โก    โ
โ (ุงูุณูุงุญ ุจุฏูุฉ ุงูุฏูุงุฆู ูู ุงูุฅุฐู)         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ุณูุฑ ุงูุนูู (Workflow)

### ุงูุณููุงุฑูู 1: ุฅูุดุงุก ูููุงููุฉ ุฅุฐู ุชุฃุฎูุฑ

```
1๏ธโฃ ุงูุฅุฏุงุฑุฉ ุชูุชุญ ุตูุญุฉ "ุงูุทูุจุงุช"
   โ
2๏ธโฃ ุชุถุบุท ุนูู ุฒุฑ "ุฅุฐู ุชุฃุฎูุฑ"
   โ
3๏ธโฃ ุชููุฃ ุงูุจูุงูุงุช:
   - ุงูููุธู: ูุญูุฏ ุฃุญูุฏ
   - ุงูุชุงุฑูุฎ: 2026-01-30
   - ูู: 09:00
   - ุฅูู: 09:30
   - ุงูุณุจุจ: ุญุงูุฉ ุทุงุฑุฆุฉ
   โ
4๏ธโฃ ุงููุธุงู ูุญุณุจ ุชููุงุฆูุงู: 30 ุฏูููุฉ
   โ
5๏ธโฃ ุงูุชุญูู ูู ุงูุตุญุฉ:
   โ ููุช ุงูููุงูุฉ > ููุช ุงูุจุฏุงูุฉ
   โ ุงููุฏุฉ โค 2 ุณุงุนุฉ (ุงูุญุฏ ุงูุฃูุตู)
   โ ูุง ููุฌุฏ ุฅุฐู ุขุฎุฑ ูู ููุณ ุงูููู
   โ
6๏ธโฃ ูุชู ุฅูุดุงุก ุงูุทูุจ ุจุญุงูุฉ "pending"
   โ
7๏ธโฃ ุงูุฅุฏุงุฑุฉ ุชุฑุงุฌุน ุงูุทูุจ ูุชูุงูู ุนููู
   โ
8๏ธโฃ ุงูุญุงูุฉ ุชุชุบูุฑ ุฅูู "approved"
   โ
9๏ธโฃ ุนูุฏ ุฅูุดุงุก ูุดู ุงูุฑูุงุชุจ:
   - ุงููุธุงู ูุฌูุจ ุงูุชุฃุฎูุฑ ุงููุนูู: 60 ุฏูููุฉ
   - ุงููุธุงู ูุฌูุจ ุงูุฅุฐู ุงููุนุชูุฏ: 30 ุฏูููุฉ
   - ูุญุณุจ ุงูุตุงูู: 60 - 30 = 30 ุฏูููุฉ
   - ุงูุฎุตู ููุทุจู ุนูู 30 ุฏูููุฉ ููุท โ
```

### ุงูุณููุงุฑูู 2: ุฅุฐู ูุบุทู ุงูุชุฃุฎูุฑ ุจุงููุงูู

```
ุงูุชุฃุฎูุฑ ุงููุนูู: 45 ุฏูููุฉ
ุฅุฐู ูุนุชูุฏ: 60 ุฏูููุฉ
ุตุงูู ุงูุชุฃุฎูุฑ: max(0, 45 - 60) = 0
ุงูุฎุตู: 0 ุฑูุงู โ
```

### ุงูุณููุงุฑูู 3: ุฅุฐู ุฌุฒุฆู

```
ุงูุชุฃุฎูุฑ ุงููุนูู: 90 ุฏูููุฉ
ุฅุฐู ูุนุชูุฏ: 30 ุฏูููุฉ
ุตุงูู ุงูุชุฃุฎูุฑ: 90 - 30 = 60 ุฏูููุฉ
ุงูุฎุตู: ููุญุณุจ ุนูู 60 ุฏูููุฉ โ
```

### ุงูุณููุงุฑูู 4: ุฑูุถ ุงูุฅุฐู

```
ุงูุชุฃุฎูุฑ ุงููุนูู: 60 ุฏูููุฉ
ุฅุฐู ูุฑููุถ: 30 ุฏูููุฉ
ุตุงูู ุงูุชุฃุฎูุฑ: 60 ุฏูููุฉ (ุงูุฅุฐู ูุง ููุญุชุณุจ)
ุงูุฎุตู: ููุญุณุจ ุนูู 60 ุฏูููุฉ ูุงููุฉ โ
```

---

## ุงูุชุญูู ูู ุงูุตุญุฉ (Validation Rules)

### 1. ููุงุนุฏ ุงูููุช
```typescript
โ end_time > start_time
โ ุฅุฐุง ูุงู end_time <= start_time:
   "ููุช ุงูููุงูุฉ ูุฌุจ ุฃู ูููู ุฃูุจุฑ ูู ููุช ุงูุจุฏุงูุฉ"
```

### 2. ุงูุญุฏ ุงูุฃูุตู ุงููููู
```typescript
โ minutes <= (max_delay_hours_per_day * 60)
โ ุฅุฐุง ุชุฌุงูุฒ:
   "ุงูุญุฏ ุงูุฃูุตู 2 ุณุงุนุฉ (120 ุฏูููุฉ)"
```

### 3. ููุน ุงูุชุฏุงุฎู
```typescript
โ ูุง ููุฌุฏ ุฅุฐู ุขุฎุฑ (pending ุฃู approved) ูู ููุณ ุงูููู
โ ุฅุฐุง ููุฌุฏ:
   "ููุฌุฏ ุฅุฐู ุชุฃุฎูุฑ ูู ููุณ ุงูููู ูููุณ ุงูููุธู"
```

### 4. ุงูุชูุณูู
```typescript
โ date: YYYY-MM-DD
โ start_time: HH:MM (24-hour format)
โ end_time: HH:MM (24-hour format)
โ minutes: integer > 0
```

---

## ูุซุงู ูุงูู ุนูู ุญุณุงุจ ุงูุฑูุงุชุจ

### ุงูุจูุงูุงุช ุงูุฃูููุฉ
```typescript
ุงูููุธู: ูุญูุฏ ุฃุญูุฏ
ุงูุฑุงุชุจ ุงููููู: 200 ุฑูุงู
ุงููุชุฑุฉ: 1/2026 (ูู 1 ุฅูู 31)

ุณุฌูุงุช ุงูุญุถูุฑ:
- 2026-01-05: ุชุฃุฎูุฑ 60 ุฏูููุฉ
- 2026-01-10: ุชุฃุฎูุฑ 45 ุฏูููุฉ
- 2026-01-15: ุชุฃุฎูุฑ 90 ุฏูููุฉ

ุฃุฐููุงุช ุงูุชุฃุฎูุฑ ุงููุนุชูุฏุฉ:
- 2026-01-05: 30 ุฏูููุฉ (ูุนุชูุฏ)
- 2026-01-10: 60 ุฏูููุฉ (ูุนุชูุฏ)
- 2026-01-15: 0 ุฏูููุฉ (ูุฑููุถ)
```

### ุงูุญุณุงุจ
```typescript
ููุงุนุฏ ุฎุตู ุงูุชุฃุฎูุฑ:
- 0-30 ุฏูููุฉ: 0 ุฑูุงู
- 30-60 ุฏูููุฉ: 20 ุฑูุงู
- 60-120 ุฏูููุฉ: 50 ุฑูุงู
- 120+ ุฏูููุฉ: 100 ุฑูุงู

ุญุณุงุจ ูู ููู:

ููู 2026-01-05:
  ุงูุชุฃุฎูุฑ ุงููุนูู: 60 ุฏูููุฉ
  ุงูุฅุฐู ุงููุนุชูุฏ: 30 ุฏูููุฉ
  ุตุงูู ุงูุชุฃุฎูุฑ: 60 - 30 = 30 ุฏูููุฉ
  ุงูุฎุตู: 0 ุฑูุงู โ (ุถูู ูุทุงู 0-30)

ููู 2026-01-10:
  ุงูุชุฃุฎูุฑ ุงููุนูู: 45 ุฏูููุฉ
  ุงูุฅุฐู ุงููุนุชูุฏ: 60 ุฏูููุฉ
  ุตุงูู ุงูุชุฃุฎูุฑ: max(0, 45 - 60) = 0 ุฏูููุฉ
  ุงูุฎุตู: 0 ุฑูุงู โ (ูุง ููุฌุฏ ุชุฃุฎูุฑ ุตุงูู)

ููู 2026-01-15:
  ุงูุชุฃุฎูุฑ ุงููุนูู: 90 ุฏูููุฉ
  ุงูุฅุฐู ุงููุนุชูุฏ: 0 ุฏูููุฉ (ูุฑููุถ)
  ุตุงูู ุงูุชุฃุฎูุฑ: 90 - 0 = 90 ุฏูููุฉ
  ุงูุฎุตู: 50 ุฑูุงู โ (ุถูู ูุทุงู 60-120)

ุฅุฌูุงูู ุฎุตู ุงูุชุฃุฎูุฑ: 0 + 0 + 50 = 50 ุฑูุงู

ููุฑุฉ ุนูู ุงูููุธู: 70 ุฑูุงู
(ุจุฏูู ุงูุฃุฐููุงุช ูุงู ุงูุฎุตู: 20 + 20 + 50 = 90 + 30 = 120 ุฑูุงู)
```

---

## ุงููููุงุช ุงููุนุฏูุฉ/ุงููุถุงูุฉ

### 1. Database Migration
```
โ supabase/migrations/[timestamp]_add_delay_permissions_system.sql
   - ุฅูุดุงุก ุฌุฏูู delay_permissions
   - ุฅุถุงูุฉ ุฃุนูุฏุฉ ุนูู payroll_settings
   - ุฅุนุฏุงุฏ RLS policies
   - ุฅูุดุงุก indexes
   - ุฅูุดุงุก triggers
```

### 2. Components
```
โ src/components/DelayPermissionModal.tsx (ุฌุฏูุฏ)
   - ูุงุฌูุฉ ุฅูุดุงุก ุทูุจุงุช ุฅุฐู ุงูุชุฃุฎูุฑ
   - ุนุฑุถ ุณุฌู ุงูุฃุฐููุงุช
   - ุงูููุงููุฉ/ุงูุฑูุถ/ุงูุญุฐู

โ src/components/PayrollSettings.tsx (ูุญุฏูุซ)
   - ุฅุถุงูุฉ ูุณู "ุฅุนุฏุงุฏุงุช ุฅุฐู ุงูุชุฃุฎูุฑ"
   - ุชูุนูู/ุชุนุทูู ุงูููุฒุฉ
   - ุถุจุท ุงูุญุฏ ุงูุฃูุตู ุงููููู
   - ุงูุณูุงุญ ุจุงูุฏูุงุฆู
```

### 3. Pages
```
โ src/pages/LeaveRequests.tsx (ูุญุฏูุซ)
   - ุฅุถุงูุฉ ุฒุฑ "ุฅุฐู ุชุฃุฎูุฑ"
   - ุฏูุฌ DelayPermissionModal

โ src/pages/Payroll.tsx (ูุญุฏูุซ)
   - ุฌูุจ delay_permissions ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุชูุฑูุฑ ุงูุจูุงูุงุช ุฅูู calculatePayroll
```

### 4. Utils
```
โ src/utils/payrollCalculations.ts (ูุญุฏูุซ)
   - ุฅุถุงูุฉ interface DelayPermission
   - ุชุญุฏูุซ PayrollCalculation metadata
   - ุชุญุฏูุซ calculatePayroll function
   - ููุทู ุญุณุงุจ ุตุงูู ุงูุชุฃุฎูุฑ
```

---

## ุญุงูุงุช ุงูุงุฎุชุจุงุฑ (Test Cases)

### Test 1: ุฅูุดุงุก ุฅุฐู ุตุญูุญ โ
```typescript
Input:
  - employee_id: valid
  - date: 2026-01-30
  - start_time: 09:00
  - end_time: 09:30
  - reason: "ุญุงูุฉ ุทุงุฑุฆุฉ"

Expected:
  - Status: 201 Created
  - minutes: 30
  - status: 'pending'
```

### Test 2: ููุช ุบูุฑ ุตุญูุญ โ
```typescript
Input:
  - start_time: 09:30
  - end_time: 09:00 (ุฃุตุบุฑ ูู ุงูุจุฏุงูุฉ)

Expected:
  - Validation Error
  - "ููุช ุงูููุงูุฉ ูุฌุจ ุฃู ูููู ุฃูุจุฑ ูู ููุช ุงูุจุฏุงูุฉ"
```

### Test 3: ุชุฌุงูุฒ ุงูุญุฏ ุงูุฃูุตู โ
```typescript
Input:
  - start_time: 08:00
  - end_time: 11:00 (3 ุณุงุนุงุช)
  - max_delay_hours_per_day: 2

Expected:
  - Validation Error
  - "ุงูุญุฏ ุงูุฃูุตู 2 ุณุงุนุฉ (120 ุฏูููุฉ)"
```

### Test 4: ุชุฏุงุฎู ุงูุฃุฐููุงุช โ
```typescript
Existing:
  - date: 2026-01-30
  - status: 'pending'

New Request:
  - date: 2026-01-30

Expected:
  - Validation Error
  - "ููุฌุฏ ุฅุฐู ุชุฃุฎูุฑ ูู ููุณ ุงูููู"
```

### Test 5: ุญุณุงุจ ุงูุฑูุงุชุจ ูุน ุฅุฐู โ
```typescript
Input:
  - lateMinutes: 60
  - approvedPermission: 30

Expected:
  - netLateMinutes: 30
  - deduction: calculated on 30 minutes only
  - metadata.totalPermissionMinutes: 30
```

### Test 6: ุญุณุงุจ ุงูุฑูุงุชุจ ุจุฏูู ุฅุฐู โ
```typescript
Input:
  - lateMinutes: 60
  - approvedPermission: null

Expected:
  - netLateMinutes: 60
  - deduction: calculated on 60 minutes
  - metadata.totalPermissionMinutes: 0
```

---

## ููุงุญุธุงุช ูููุฉ

### โ ูุง ุชู ุชูููุฐู:
1. ูุงุนุฏุฉ ุจูุงูุงุช ูุงููุฉ ูุน RLS
2. ูุงุฌูุฉ ูุณุชุฎุฏู ูุชูุงููุฉ
3. ููุทู ุญุณุงุจ ุงููุฑุชุจุงุช
4. ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต
5. ุงูุชุญูู ูู ุงูุตุญุฉ ุงูุดุงูู
6. ุงูุนุฒู ูุชุนุฏุฏ ุงููุณุชุฃุฌุฑูู

### โ๏ธ ุงููููุฏ ุงูุญุงููุฉ:
1. **ุงูููุงููุฉ ููุท ูู ุงูุฅุฏุงุฑุฉ**: ูุง ูููู ููููุธููู ุชูุฏูู ุงูุทูุจุงุช ุจุฃููุณูู (ุญุณุจ ุงููุชุทูุจุงุช)
2. **ุงูุฅุฐู ูููู**: ูู ุฅุฐู ูุชุงุฑูุฎ ูุงุญุฏ ููุท
3. **ูุง ูุคุซุฑ ุนูู ุงูุบูุงุจ**: ุงูุฅุฐู ูููู ููุท ูู ุฎุตู ุงูุชุฃุฎูุฑ

### ๐ฎ ุชุญุณููุงุช ูุณุชูุจููุฉ ูุญุชููุฉ:
1. ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุนูุฏ ุงูููุงููุฉ/ุงูุฑูุถ
2. ุงูุณูุงุญ ููููุธููู ุจุชูุฏูู ุงูุทูุจุงุช
3. ุชูุงุฑูุฑ ุชูุตูููุฉ ูุงุณุชุฎุฏุงู ุงูุฃุฐููุงุช
4. ุญุฏ ุฃูุตู ุดูุฑู ููุฃุฐููุงุช
5. ุนุฑุถ ูุนูููุงุช ุงูุฃุฐููุงุช ูู modal ุชูุงุตูู ุงููุฑุชุจ

---

## ุงูุฎูุงุตุฉ

ุชู ุชูููุฐ ูุธุงู ุฅุฐู ุงูุชุฃุฎูุฑ ุจุดูู ูุงูู ููุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู. ุงูููุฒุฉ:
- โ **ุขููุฉ**: RLS policies ูุญููุฉ
- โ **ูุฑูุฉ**: ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต
- โ **ุฏูููุฉ**: ุญุณุงุจ ุตุญูุญ ููุฑูุงุชุจ
- โ **ุณููุฉ ุงูุงุณุชุฎุฏุงู**: ูุงุฌูุฉ ุจุณูุทุฉ ููุงุถุญุฉ
- โ **ูุชุนุฏุฏุฉ ุงููุณุชุฃุฌุฑูู**: ุนุฒู ูุงูู ุจูู ุงูุดุฑูุงุช

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู!** โ
