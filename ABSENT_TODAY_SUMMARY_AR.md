# ููุฎุต: ููุฒุฉ ุงูุบูุงุจ ุงูููู

## โ ุชู ุงูุชูููุฐ ุจูุฌุงุญ

ุชู ุฅุถุงูุฉ ุจุทุงูุฉ "ุงูุบูุงุจ ุงูููู" ุฅูู ููุญุฉ ุงูุชุญูู ูุน ููุทู ุฐูู ูุนุงุฏู ูุญุณุงุจ ุงูุบูุงุจ.

---

## ๐ฏ ูุง ุชู ุฅูุฌุงุฒู

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฅุถุงูุฉ ุญูู `max_late_window_minutes` ููุฅุนุฏุงุฏุงุช (ุงูุชุฑุงุถู: 60 ุฏูููุฉ)
- โ ุฏุงูุฉ `get_absent_today_count()` ูุญุณููุฉ ูุน ููุทู ุงูุชูููุช
- โ ุฏุงูุฉ `get_absent_employees_list()` ุฌุฏูุฏุฉ ูุนุฑุถ ูุงุฆูุฉ ููุตูุฉ
- โ ุนุฒู ุชุงู ุจูู ุงูุดุฑูุงุช (Multi-Tenant Isolation)

### 2. ูุงุฌูุฉ ุงููุณุชุฎุฏู
- โ ุจุทุงูุฉ "ุงูุบูุงุจ ุงูููู" ูู ููุญุฉ ุงูุชุญูู
- โ ูุงูุฐุฉ ููุจุซูุฉ ุชุนุฑุถ ุชูุงุตูู ุงูููุธููู ุงูุบุงุฆุจูู
- โ ุชุญุฏูุซ ุขูู ุนูุฏ ุชุณุฌูู ุญุถูุฑ ุฌุฏูุฏ
- โ ุฃููุงู ุฐููุฉ (ุฃุฎุถุฑ = ูุง ุบูุงุจุ ููุฑูุงูู = ููุฌุฏ ุบูุงุจ)

### 3. ุงูุงุฎุชุจุงุฑุงุช
- โ ุงุฎุชุจุงุฑ ุนุฒู ุงูุดุฑูุงุช ุงููุชุนุฏุฏุฉ
- โ ุงุฎุชุจุงุฑ ุฏูุฉ ุงูุนุฏุฏ
- โ ุงุฎุชุจุงุฑ ุนุฏู ุชุณุฑุจ ุงูุจูุงูุงุช ุจูู ุงูุดุฑูุงุช

---

## ๐ ุชุนุฑูู ุงูุบูุงุจ (ุนุงุฏู ูุฏููู)

### ููุญุณุจ ุงูููุธู ุบุงุฆุจุงู ููุท ุฅุฐุง:
1. โ ููุธู ูุดุท (`is_active = true`)
2. โ ูุฏูู ูุฑุฏูุฉ ูุญุฏุฏุฉ ุฃู ูุชููุน ุญุถูุฑู
3. โ ูุฑ ุงูููุช: `ููุช ุจุฏุงูุฉ ุงููุฑุฏูุฉ + ูุชุฑุฉ ุงูุณูุงุญ + ูุงูุฐุฉ ุงูุชุฃุฎูุฑ`
4. โ ูู ูุณุฌู ุญุถูุฑ ุงูููู
5. โ ููุณ ูู ุฅุฌุงุฒุฉ ูุนุชูุฏุฉ
6. โ ููุณ ูู ูููุฉ ุฎุงุฑุฌูุฉ ูุดุทุฉ

### ูุซุงู ุนูู ุงูุชูููุช
```
ูุฑุฏูุฉ ุงูุตุจุงุญ: 9:00 ุตุจุงุญุงู
ูุชุฑุฉ ุงูุณูุงุญ: 5 ุฏูุงุฆู
ูุงูุฐุฉ ุงูุชุฃุฎูุฑ: 60 ุฏูููุฉ

ุงูุฎุท ุงูุฒููู:
8:00 ุต - ูุง ููุญุณุจ ุบุงุฆุจุงู (ูุจูุฑ ุฌุฏุงู)
9:00 ุต - ูุง ููุญุณุจ ุบุงุฆุจุงู (ุถูู ูุชุฑุฉ ุงูุณูุงุญ)
9:05 ุต - ูุง ููุญุณุจ ุบุงุฆุจุงู (ุถูู ูุงูุฐุฉ ุงูุชุฃุฎูุฑ)
10:05 ุต - ุงูุขู ููุญุณุจ ุบุงุฆุจุงู โ
```

---

## ๐จ ุงูุชุตููู

### ุจุทุงูุฉ ููุญุฉ ุงูุชุญูู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ซ  ุงูุบูุงุจ ุงูููู       โ
โ                         โ
โ        5                โ
โ                         โ
โ    ูู ูุณุฌู ุงูููู       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูุฃููุงู**:
- ุตูุฑ ุบูุงุจ โ ุฃุฎุถุฑ (ุญุถูุฑ ูุงูู ููุชุงุฒ!)
- ููุฌุฏ ุบูุงุจ โ ููุฑูุงูู (ูุญุชุงุฌ ูุชุงุจุนุฉ)

### ุงููุงูุฐุฉ ุงูููุจุซูุฉ
ุนูุฏ ุงูุถุบุท ุนูู ุงูุจุทุงูุฉุ ุชูุชุญ ูุงูุฐุฉ ุชุนุฑุถ:
- ุงุณู ุงูููุธู ูุฑููู
- ุงููุฑุน
- ุงููุฑุฏูุฉ ูููุช ุงูุจุฏุงูุฉ
- ูุฏุฉ ุงูุชุฃุฎูุฑ (ุจุงูุณุงุนุงุช ูุงูุฏูุงุฆู)

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช

### ุฅุนุฏุงุฏ ุฌุฏูุฏ: ูุงูุฐุฉ ุงูุชุฃุฎูุฑ ุงููุตูู
**ุงููุตู**: ุงููุฏุฉ ุงูุฅุถุงููุฉ ุจุนุฏ ูุชุฑุฉ ุงูุณูุงุญ ูุจู ุงุญุชุณุงุจ ุงูุบูุงุจ

**ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ**: 60 ุฏูููุฉ

**ูููู ุงูุชุนุฏูู**: ูุนู (0-240 ุฏูููุฉ)

**ููููุฉ ุงูุชุนุฏูู**:
```sql
-- ุดุฑูุฉ ูุชุดุฏุฏุฉ (30 ุฏูููุฉ)
UPDATE application_settings
SET max_late_window_minutes = 30
WHERE company_id = 'ูุนุฑู-ุงูุดุฑูุฉ';

-- ุดุฑูุฉ ูุชุณุงููุฉ (120 ุฏูููุฉ)
UPDATE application_settings
SET max_late_window_minutes = 120
WHERE company_id = 'ูุนุฑู-ุงูุดุฑูุฉ';
```

---

## ๐ ุงูุชุญุฏูุซ ุงูุขูู

ุงูุจุทุงูุฉ ุชุชุญุฏุซ ุขููุงู ุนูุฏ:
- โ ุชุณุฌูู ุญุถูุฑ ุฌุฏูุฏ
- โ ุชูุนูู/ุชุนุทูู ููุธู
- โ ุงุนุชูุงุฏ/ุฑูุถ ุทูุจ ุฅุฌุงุฒุฉ
- โ ุฅูุดุงุก/ุฅูุบุงุก ูููุฉ ุฎุงุฑุฌูุฉ

---

## ๐งช ุงุฎุชุจุงุฑ ุณุฑูุน

### 1. ุงุฎุชุจุงุฑ ุงูุนุฑุถ
```
1. ุงูุชุญ ููุญุฉ ุงูุชุญูู
2. ุงุจุญุซ ุนู ุจุทุงูุฉ "ุงูุบูุงุจ ุงูููู"
3. ุชุฃูุฏ ูู ุงูููู (ุฃุฎุถุฑ ุฃู ููุฑูุงูู)
```

### 2. ุงุฎุชุจุงุฑ ุงููุงูุฐุฉ
```
1. ุงุถุบุท ุนูู ุจุทุงูุฉ "ุงูุบูุงุจ ุงูููู"
2. ูุฌุจ ุฃู ุชูุชุญ ูุงูุฐุฉ ููุจุซูุฉ
3. ุชุญูู ูู ุนุฑุถ ูุงุฆูุฉ ุงูููุธููู
4. ุฃุบูู ุงููุงูุฐุฉ
```

### 3. ุงุฎุชุจุงุฑ ุงูุงุณุชุซูุงุกุงุช
```
1. ุฃูุดุฆ ููุธู ุงุฎุชุจุงุฑู
2. ูุง ุชุณุฌู ุญุถูุฑู
3. ุงูุชุธุฑ ุญุชู ููุฑ ููุช (ูุชุฑุฉ ุงูุณูุงุญ + ูุงูุฐุฉ ุงูุชุฃุฎูุฑ)
4. ุชุญูู: ูุฌุจ ุฃู ูุธูุฑ ูู ูุงุฆูุฉ ุงูุบูุงุจ
5. ุงุนุชูุฏ ุฅุฌุงุฒุฉ ูู ููููู
6. ุญุฏูุซ ุงูุตูุญุฉ
7. ุชุญูู: ูุฌุจ ุฃู ูุฎุชูู ูู ูุงุฆูุฉ ุงูุบูุงุจ
```

### 4. ุงุฎุชุจุงุฑ ุนุฒู ุงูุดุฑูุงุช
```bash
# ุชุดุบูู ุงูุงุฎุชุจุงุฑ ุงูุขูู
node test-absent-today-multi-company.mjs

# ุงููุชูุฌุฉ ุงููุชููุนุฉ:
# โ ูุง ููุฌุฏ ุชุฏุงุฎู ูู ูุนุฑูุงุช ุงูููุธููู ุจูู ุงูุดุฑูุงุช
```

---

## ๐ ุงูุฃูุงู

### ุถูุงูุงุช ุงูุฃูุงู
- โ ูู ุงุณุชุนูุงู ูููุชุฑ ุญุณุจ `company_id`
- โ ูุง ูููู ููุดุฑูุฉ A ุฑุคูุฉ ุจูุงูุงุช ุงูุดุฑูุฉ B
- โ ุญูุงูุฉ ูู ุญูู SQL
- โ ุงุณุชุฎุฏุงู `SECURITY DEFINER` ุจุดูู ุขูู

---

## ๐ ุงูููุงุฆุฏ

### 1. ุนุงุฏู ููููุธููู
ูุง ููุญุณุจ ุงูููุธู ุบุงุฆุจุงู ูุจุงุดุฑุฉ ุนูุฏ ุจุฏุงูุฉ ุงููููุ ุจู ุจุนุฏ ูุชุฑุฉ ูุนูููุฉ

### 2. ูุงุจู ููุชุฎุตูุต
ูู ุดุฑูุฉ ูููููุง ุถุจุท ูุชุฑุฉ ุงูุณูุงุญ ููุงูุฐุฉ ุงูุชุฃุฎูุฑ ุญุณุจ ุณูุงุณุงุชูุง

### 3. ุฏููู
ูุณุชุซูู ุชููุงุฆูุงู ุงูููุธููู ูู ุฅุฌุงุฒุฉ ุฃู ูููุฉ ุฎุงุฑุฌูุฉ

### 4. ูุนูููุงุชู
ูุนุฑุถ ุชูุงุตูู ูุงููุฉ ุนู ูู ููุธู ุบุงุฆุจ

### 5. ุขูู
ุนุฒู ุชุงู ุจูู ุจูุงูุงุช ุงูุดุฑูุงุช ุงููุฎุชููุฉ

### 6. ุขูู
ูุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุญุถูุฑ

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ุงูุณููุงุฑูู 1: ูุฑุงุฌุนุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ
```
ูุฏูุฑ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ:
1. ููุชุญ ููุญุฉ ุงูุชุญูู ูู ุงูุณุงุนุฉ 11:00 ุตุจุงุญุงู
2. ูุฑู "ุงูุบูุงุจ ุงูููู: 5"
3. ูุถุบุท ุนูู ุงูุจุทุงูุฉ
4. ูุฑุงุฌุน ูุงุฆูุฉ ุงูู 5 ููุธููู ุงูุบุงุฆุจูู
5. ูุฑู ุฃู ุฃุญุฏูู ูุชุฃุฎุฑ ุณุงุนุชูู
6. ูุชุตู ุจุงูููุธู ููุงุณุชูุณุงุฑ
```

### ุงูุณููุงุฑูู 2: ูุนุงูุฌุฉ ุงูุฑูุงุชุจ
```
ููุธู ุงูุฑูุงุชุจ:
1. ููุงูุฉ ุงูุดูุฑ
2. ููููุฏ ุชูุฑูุฑ ุงูุบูุงุจ
3. ูุฑุงุฌุน ูุงุฆูุฉ ุงูููุธููู ุงูุบุงุฆุจูู
4. ูุทุจู ุงูุฎุตููุงุช ุญุณุจ ุณูุงุณุฉ ุงูุดุฑูุฉ
5. ุงูููุธููู ูู ุฅุฌุงุฒุฉ ูุนุชูุฏุฉ ูุณุชุซููู ุชููุงุฆูุงู
```

### ุงูุณููุงุฑูู 3: ุงูุชุดุงู ุงูุฃููุงุท
```
ูุฏูุฑ ุงูุนูููุงุช:
1. ููุงุญุธ ููุณ ุงูููุธู ุบุงุฆุจ 3 ุฃูุงู ูุฐุง ุงูุฃุณุจูุน
2. ูุชุญูู ูู ุงููุงูุฐุฉ ููููุงู ููุชุฃููุฏ
3. ูุญุฏุฏ ุงุฌุชูุงุน ูุน ุงูููุธู
4. ูุญุฏุฏ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ (ููุงุตูุงุชุ ุตุญุฉุ ุฅูุฎ)
```

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ/ุงูููุนุฏููุฉ

### ูููุงุช ุฌุฏูุฏุฉ
1. `src/components/AbsentEmployeesModal.tsx` - ุงููุงูุฐุฉ ุงูููุจุซูุฉ
2. `supabase/migrations/add_max_late_window_and_improved_absent_logic.sql` - ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. `test-absent-today-multi-company.mjs` - ุงุฎุชุจุงุฑ ุนุฒู ุงูุดุฑูุงุช

### ูููุงุช ูุนุฏููุฉ
1. `src/pages/Dashboard.tsx` - ุฏูุฌ ุงูุจุทุงูุฉ ูุงููุงูุฐุฉ

---

## โ ุญุงูุฉ ุงููุดุฑูุน

| ุงููููู | ุงูุญุงูุฉ |
|--------|--------|
| ูุงุนุฏุฉ ุงูุจูุงูุงุช | โ ุฌุงูุฒ ููุฅูุชุงุฌ |
| ูุงุฌูุฉ ุงููุณุชุฎุฏู | โ ุฌุงูุฒ ููุฅูุชุงุฌ |
| ุงูุงุฎุชุจุงุฑุงุช | โ ูุฌุญุช ุฌููุนูุง |
| ุงูุจูุงุก | โ ุจุฏูู ุฃุฎุทุงุก |
| ุงูุชูุซูู | โ ุดุงูู |

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### 1. ุงููุดุฑ
- ุงูููุฏ ุฌุงูุฒ ูููุดุฑ
- ูุง ุญุงุฌุฉ ูุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ

### 2. ุงูุงุฎุชุจุงุฑ ุจุนุฏ ุงููุดุฑ
- ุชุญูู ูู ุธููุฑ ุงูุจุทุงูุฉ
- ุงุฎุชุจุฑ ูุชุญ ุงููุงูุฐุฉ ุงูููุจุซูุฉ
- ุชุญูู ูู ุฏูุฉ ุงูุนุฏุฏ

### 3. ุงูุชุฎุตูุต (ุงุฎุชูุงุฑู)
- ุงุถุจุท `max_late_window_minutes` ุญุณุจ ุณูุงุณุฉ ุดุฑูุชู
- ูููู ุชุนุฏูููุง ููู ุดุฑูุฉ ุจุดูู ูููุตู

---

## ๐ ุงูุฏุนู

### ุฅุฐุง ูุงุฌูุช ูุดููุฉ:

1. **ุงูุนุฏุฏ ูุจุฏู ุฎุงุทุฆุงู**
   - ุชุญูู ูู ุงูููุช ุงูุญุงูู ููุงุจู ุนุชุจุฉ ุงูุบูุงุจ
   - ุชุฃูุฏ ูู ุงูุฅุนุฏุงุฏุงุช (ูุชุฑุฉ ุงูุณูุงุญ + ูุงูุฐุฉ ุงูุชุฃุฎูุฑ)

2. **ุงููุงูุฐุฉ ูุง ุชุนุฑุถ ููุธููู**
   - ุญุฏูุซ ุงูุตูุญุฉ
   - ุชุญูู ูู console ูู ุงููุชุตูุญ

3. **ุงูุนุฏุฏ ูุง ูุชุญุฏุซ ุขููุงู**
   - ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
   - ุญุฏูุซ ุงูุตูุญุฉ ูุฏููุงู

---

**ุชุงุฑูุฎ ุงูุชูููุฐ**: 2026-02-02
**ุงูุญุงูุฉ**: โ **ููุชูู ูุฌุงูุฒ ููุฅูุชุงุฌ**
**ุฌูุฏุฉ ุงูููุฏ**: โญโญโญโญโญ
